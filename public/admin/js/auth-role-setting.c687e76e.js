"use strict";(self["webpackChunkvue_cms_admin"]=self["webpackChunkvue_cms_admin"]||[]).push([[158],{1232:function(e,t,s){s.r(t),s.d(t,{default:function(){return _}});var r=function(){var e=this,t=e._self._c;return t("el-card",{},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("权限设置")])]),t("el-steps",{attrs:{active:e.current_step,"finish-status":"success","align-center":""}},[t("el-step",{attrs:{title:"路由权限"}}),t("el-step",{attrs:{title:"菜单、操作权限"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:0===e.current_step,expression:"current_step === 0"}],staticClass:"route-panel"},[t("el-tree",{ref:"route_tree",attrs:{data:e.routes_tree,"check-strictly":e.route_check_strictly,"show-checkbox":"","highlight-current":"","default-expand-all":"","node-key":"route_id"},scopedSlots:e._u([{key:"default",fn:function({node:s,data:r}){return t("div",{staticClass:"custom-tree-node"},[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:r.route_name,placement:"right"}},[t("span",[e._v(e._s(r.permission_remark))])])],1)}}])})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:1===e.current_step,expression:"current_step === 1"}],staticClass:"menu-panel"},[t("el-tree",{ref:"menu_tree",attrs:{data:e.menus_tree,"check-strictly":e.menu_check_strictly,"show-checkbox":"","highlight-current":"","default-expand-all":"","node-key":"permission_id"},scopedSlots:e._u([{key:"default",fn:function({node:s,data:r}){return t("div",{staticClass:"custom-tree-node"},[2===r.resource_type_id?t("div",{staticClass:"node-menu"},[t("i",{staticClass:"el-icon-notebook-2"}),e._v(" "+e._s(r.menu_name)+" ")]):e._e(),3===r.resource_type_id?t("div",{staticClass:"node-operation"},[t("i",{staticClass:"el-icon-s-operation"}),e._v(" "+e._s(r.operation_name)+" ")]):e._e()])}}])})],1),t("div",{staticClass:"action-section am-padding-vertical"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.current_step,expression:"current_step === 0"}],attrs:{type:"primary",size:"medium"},on:{click:e.handleStepNext}},[e._v("下一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.current_step,expression:"current_step === 0"}],attrs:{plain:"",size:"medium"},on:{click:function(t){return e.$router.back()}}},[e._v("取消")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.current_step,expression:"current_step === 1"}],attrs:{plain:"",size:"medium"},on:{click:e.handleStepPrev}},[e._v("上一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.current_step,expression:"current_step === 1"}],attrs:{type:"success",size:"medium"},on:{click:e.handleSetAll}},[e._v("保存设置")])],1)],1)},i=[],a=(s(7658),s(629)),n=s(1803),c={name:"Setting",props:["role_id"],data(){return{current_step:0,route_check_strictly:!0,route_checked_keys:[],menus_tree:[],menu_check_strictly:!0}},computed:{...(0,a.Se)("Route",["routes_tree"]),...(0,a.Se)("Menu",["menu_from_checked_route"])},created(){document.title="设置角色权限",this.restoreCheckedRoute()},methods:{async restoreCheckedRoute(){let{status:e,data:t}=await n.uU.route({role_id:this.role_id,type:"flat"});if(e){let e=t.map((e=>e.route_id));this.$refs.route_tree.setCheckedKeys(e),this.route_check_strictly=!1}},handleStepNext(){let e=this.$refs.route_tree.getCheckedNodes(!1,!0);this.route_checked_keys=e.map((e=>e.permission_id)),this.menus_tree=this.menu_from_checked_route(e),this.restoreCheckedMenu(e),this.current_step=1},handleStepPrev(){this.menu_check_strictly=!0,this.current_step=0},async restoreCheckedMenu(e){let{status:t,data:s}=await n.uU.menu({role_id:this.role_id,type:"flat"});if(t){let t=[];s.forEach((r=>{let i=e.some((e=>e.route_id===r.route_id));if(i){t.push(r.permission_id);let e=s.filter((e=>3===e.resource_type_id&&e.parent_id===r.permission_id)),i=e.map((e=>e.permission_id));t.push(...i)}})),this.$refs.menu_tree.setCheckedKeys(t),this.menu_check_strictly=!1}},getCheckedMenu(){let e=this.$refs.menu_tree.getCheckedKeys(),t=this.$refs.menu_tree.getHalfCheckedKeys();return[...e,...t]},async handleSetAll(){let{status:e,msg:t}=await n.uU.set_route({role_id:this.role_id,permissions:this.route_checked_keys}),s=this.getCheckedMenu(),{status:r,msg:i}=await n.uU.set_menu({role_id:this.role_id,permissions:s});e&&r?(this.$message.success("权限设置成功！"),this.$router.back()):(this.$message.error(t),this.$message.error(i))}}},o=c,u=s(1001),l=(0,u.Z)(o,r,i,!1,null,"1a98582b",null),_=l.exports}}]);
//# sourceMappingURL=auth-role-setting.c687e76e.js.map