{"version":3,"file":"js/auth-role-setting.7e5f4b0a.js","mappings":"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","sources":["webpack://vue-cms-admin/./src/views/Role/Setting.vue","webpack://vue-cms-admin/src/views/Role/Setting.vue","webpack://vue-cms-admin/./src/views/Role/Setting.vue?bf69","webpack://vue-cms-admin/./src/views/Role/Setting.vue?ef74"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-card',{},[_c('div',{attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"权限设置\")])]),_c('el-steps',{attrs:{\"active\":_vm.current_step,\"finish-status\":\"success\",\"align-center\":\"\"}},[_c('el-step',{attrs:{\"title\":\"路由权限\"}}),_c('el-step',{attrs:{\"title\":\"菜单、操作权限\"}})],1),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.current_step === 0),expression:\"current_step === 0\"}],staticClass:\"route-panel\"},[_c('el-tree',{ref:\"route_tree\",attrs:{\"data\":_vm.routes_tree,\"check-strictly\":_vm.route_check_strictly,\"show-checkbox\":\"\",\"highlight-current\":\"\",\"default-expand-all\":\"\",\"node-key\":\"route_id\"},scopedSlots:_vm._u([{key:\"default\",fn:function({ node, data }){return _c('div',{staticClass:\"custom-tree-node\"},[_c('el-tooltip',{staticClass:\"item\",attrs:{\"effect\":\"dark\",\"content\":data.route_name,\"placement\":\"right\"}},[_c('span',[_vm._v(_vm._s(data.permission_remark))])])],1)}}])})],1),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.current_step === 1),expression:\"current_step === 1\"}],staticClass:\"menu-panel\"},[_c('el-tree',{ref:\"menu_tree\",attrs:{\"data\":_vm.menus_tree,\"check-strictly\":_vm.menu_check_strictly,\"show-checkbox\":\"\",\"highlight-current\":\"\",\"default-expand-all\":\"\",\"node-key\":\"permission_id\"},scopedSlots:_vm._u([{key:\"default\",fn:function({ node, data }){return _c('div',{staticClass:\"custom-tree-node\"},[(data.resource_type_id === 2)?_c('div',{staticClass:\"node-menu\"},[_c('i',{staticClass:\"el-icon-notebook-2\"}),_vm._v(\" \"+_vm._s(data.menu_name)+\" \")]):_vm._e(),(data.resource_type_id === 3)?_c('div',{staticClass:\"node-operation\"},[_c('i',{staticClass:\"el-icon-s-operation\"}),_vm._v(\" \"+_vm._s(data.operation_name)+\" \")]):_vm._e()])}}])})],1),_c('div',{staticClass:\"action-section am-padding-vertical\"},[_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.current_step === 0),expression:\"current_step === 0\"}],attrs:{\"type\":\"primary\",\"size\":\"medium\"},on:{\"click\":_vm.handleStepNext}},[_vm._v(\"下一步\")]),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.current_step === 0),expression:\"current_step === 0\"}],attrs:{\"plain\":\"\",\"size\":\"medium\"},on:{\"click\":function($event){return _vm.$router.back()}}},[_vm._v(\"取消\")]),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.current_step === 1),expression:\"current_step === 1\"}],attrs:{\"plain\":\"\",\"size\":\"medium\"},on:{\"click\":function($event){_vm.current_step = 0}}},[_vm._v(\"上一步\")]),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.current_step === 1),expression:\"current_step === 1\"}],attrs:{\"type\":\"success\",\"size\":\"medium\"},on:{\"click\":_vm.handleSetAll}},[_vm._v(\"保存设置\")])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <el-card class=\"\">\r\n    <div slot=\"header\">\r\n      <span>权限设置</span>\r\n    </div>\r\n    <el-steps :active=\"current_step\" finish-status=\"success\" align-center>\r\n      <el-step title=\"路由权限\"></el-step>\r\n      <el-step title=\"菜单、操作权限\"></el-step>\r\n    </el-steps>\r\n    <!-- 第一步：设置路由 -->\r\n    <div v-show=\"current_step === 0\" class=\"route-panel\">\r\n      <el-tree :data=\"routes_tree\" ref=\"route_tree\" :check-strictly=\"route_check_strictly\"\r\n               show-checkbox highlight-current default-expand-all node-key=\"route_id\">\r\n        <div class=\"custom-tree-node\" slot-scope=\"{ node, data }\">\r\n          <el-tooltip class=\"item\" effect=\"dark\" :content=\"data.route_name\" placement=\"right\">\r\n            <span>{{ data.permission_remark }}</span>\r\n          </el-tooltip>\r\n        </div>\r\n      </el-tree>\r\n    </div>\r\n    <!-- 第二步：设置菜单/操作按钮 -->\r\n    <div class=\"menu-panel\" v-show=\"current_step === 1\">\r\n      <el-tree :data=\"menus_tree\" ref=\"menu_tree\" :check-strictly=\"menu_check_strictly\"\r\n               show-checkbox highlight-current default-expand-all node-key=\"permission_id\">\r\n        <div class=\"custom-tree-node\" slot-scope=\"{ node, data }\">\r\n          <!-- 菜单 -->\r\n          <div class=\"node-menu\" v-if=\"data.resource_type_id === 2\">\r\n            <i class=\"el-icon-notebook-2\"></i>\r\n            {{ data.menu_name }}\r\n          </div>\r\n          <!-- 操作按钮 -->\r\n          <div class=\"node-operation\" v-if=\"data.resource_type_id === 3\">\r\n            <i class=\"el-icon-s-operation\"></i>\r\n            {{ data.operation_name }}\r\n          </div>\r\n        </div>\r\n      </el-tree>\r\n    </div>\r\n    <!-- 操作按钮 -->\r\n    <div class=\"action-section am-padding-vertical\">\r\n      <!-- 第一步：设置路由 -->\r\n      <el-button @click=\"handleStepNext\" v-show=\"current_step === 0\" type=\"primary\" size=\"medium\">下一步</el-button>\r\n      <el-button @click=\"$router.back()\" v-show=\"current_step === 0\" plain size=\"medium\">取消</el-button>\r\n      <!-- 第二步：设置菜单/操作按钮 -->\r\n      <el-button @click=\"current_step = 0\" v-show=\"current_step === 1\" plain size=\"medium\">上一步</el-button>\r\n      <el-button @click=\"handleSetAll\" v-show=\"current_step === 1\" type=\"success\" size=\"medium\">保存设置</el-button>\r\n    </div>\r\n  </el-card>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\nimport { Role } from '@/api/'\r\n\r\nexport default {\r\n  name: \"Setting\",\r\n  props: ['role_id'],\r\n  data() {\r\n    return {\r\n      // 步骤条\r\n      current_step: 0,\r\n      // 路由--是否严格的遵循父子不互相关联\r\n      route_check_strictly: true,\r\n      // 路由--选中的路由 permission_id 数组\r\n      route_checked_keys: [],\r\n      // 菜单--树形结构\r\n      menus_tree: [],\r\n      // 菜单--是否严格的遵循父子不互相关联\r\n      menu_check_strictly: true,\r\n    }\r\n  },\r\n  computed: {\r\n    // 加载所有路由权限\r\n    ...mapGetters('Route', ['routes_tree']),\r\n    ...mapGetters('Menu', ['menu_from_route_tree']),\r\n  },\r\n  created() {\r\n    // 设置 title\r\n    document.title = '设置角色权限';\r\n    // 还原以前选中的路由\r\n    this.setCheckedRoute();\r\n  },\r\n  methods: {\r\n    // 路由 -- 还原以前选中的状态\r\n    async setCheckedRoute() {\r\n      // 根据角色加载对应路由\r\n      let { status, data } = await Role.route({ role_id: this.role_id, type: 'flat' });\r\n      if (status) {\r\n        // 转化为选中的路由id\r\n        let checked_keys = data.map((route) => route.route_id);\r\n        // 设置选中的路由\r\n        this.$refs.route_tree.setCheckedKeys(checked_keys);\r\n        // 还原选中状态之后，设置父子节点互相关联\r\n        this.route_check_strictly = false;\r\n      }\r\n    },\r\n    // 下一步操作\r\n    handleStepNext() {\r\n      // 获取当前选中的路由 node节点（包含半选中父级节点）\r\n      let route_checked_nodes = this.$refs.route_tree.getCheckedNodes(false, true);\r\n      // 转化为 permission_id 数组\r\n      this.route_checked_keys = route_checked_nodes.map((route) => route.permission_id);\r\n      // 设置禁用、选中的菜单/操作按钮\r\n      this.setCheckedMenu(route_checked_nodes);\r\n      // 切换步骤条\r\n      this.current_step = 1;\r\n    },\r\n    // 菜单/操作按钮 -- 还原之前选中的状态\r\n    async setCheckedMenu(route_checked_nodes) {\r\n      // 根据角色id加载对应菜单，还原当初的选中状态\r\n      let { status, data: menu_origin_checked } = await Role.menu({ role_id: this.role_id, type: 'flat' });\r\n      if (status) {\r\n        // 整合禁用、选中的菜单 -- getters\r\n        let { menus_tree, menu_checked_permission } = this.menu_from_route_tree(route_checked_nodes, menu_origin_checked);\r\n        // 根据树形结构数据还原生成菜单\r\n        this.menus_tree = menus_tree;\r\n        // 设置选中的菜单\r\n        this.$refs.menu_tree.setCheckedKeys(menu_checked_permission);\r\n        // 还原选中状态之后，设置父子节点互相关联\r\n        this.menu_check_strictly = false;\r\n      }\r\n    },\r\n    // 菜单/操作按钮 -- 计算选中的节点keys\r\n    getCheckedMenu() {\r\n      // 获取菜单、操作按钮当前选中的node节点\r\n      let menu_checked_keys = this.$refs.menu_tree.getCheckedKeys();\r\n      // 获取菜单、操作按钮当前半选中的父级节点\r\n      let menu_half_checked_keys = this.$refs.menu_tree.getHalfCheckedKeys();\r\n      // 合并数组，缓存\r\n      return [...menu_checked_keys, ...menu_half_checked_keys];\r\n    },\r\n    // 保存全部设置\r\n    async handleSetAll() {\r\n      // 路由 -- 设置权限\r\n      let { status: route_status, msg: route_msg } = await Role.set_route({ role_id: this.role_id, permissions: this.route_checked_keys });\r\n      // 菜单/操作按钮 -- 获取选中的keys\r\n      let permissions = this.getCheckedMenu();\r\n      // 菜单/操作按钮 -- 设置权限\r\n      let { status: menu_status, msg: menu_msg } = await Role.set_menu({ role_id: this.role_id, permissions });\r\n      // 统一处理信息提示\r\n      if (route_status && menu_status) {\r\n        this.$message.success('权限设置成功！');\r\n        this.$router.back();\r\n      } else {\r\n        this.$message.error(route_msg);\r\n        this.$message.error(menu_msg);\r\n      }\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@blue: #409EFF;\r\n@green: #67C23A;\r\n@orange: #E6A23C;\r\n\r\n.route-panel, .menu-panel {\r\n  margin-top: 20px;\r\n  padding: 20px;\r\n  border-radius: 3px;\r\n}\r\n\r\n.route-panel {\r\n  border: 1px solid @blue;\r\n}\r\n\r\n.menu-panel {\r\n  border: 1px solid @green;\r\n\r\n  .node-menu i {\r\n    color: @green;\r\n  }\r\n\r\n  .node-operation i {\r\n    color: @orange;\r\n  }\r\n}\r\n\r\n.custom-tree-node {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 14px;\r\n  padding-right: 8px;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Setting.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Setting.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Setting.vue?vue&type=template&id=03b48f19&scoped=true&\"\nimport script from \"./Setting.vue?vue&type=script&lang=js&\"\nexport * from \"./Setting.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Setting.vue?vue&type=style&index=0&id=03b48f19&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"03b48f19\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","attrs","slot","_v","current_step","directives","name","rawName","value","expression","staticClass","ref","routes_tree","route_check_strictly","scopedSlots","_u","key","fn","node","data","route_name","_s","permission_remark","menus_tree","menu_check_strictly","resource_type_id","menu_name","_e","operation_name","on","handleStepNext","$event","$router","back","handleSetAll","staticRenderFns","props","route_checked_keys","computed","mapGetters","created","document","title","setCheckedRoute","methods","status","Role","role_id","type","checked_keys","map","route","route_id","$refs","route_tree","setCheckedKeys","route_checked_nodes","getCheckedNodes","permission_id","setCheckedMenu","menu_origin_checked","menu_checked_permission","menu_from_route_tree","menu_tree","getCheckedMenu","menu_checked_keys","getCheckedKeys","menu_half_checked_keys","getHalfCheckedKeys","route_status","msg","route_msg","permissions","menu_status","menu_msg","$message","success","error","component"],"sourceRoot":""}