"use strict";(self["webpackChunkvue_cms_admin"]=self["webpackChunkvue_cms_admin"]||[]).push([[123],{9424:function(e,t,r){r.d(t,{Z:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadAction,"before-upload":e.handleBeforeUpload,data:e.data,headers:e.headers,"on-error":e.handleUploadError,"on-success":e.handleUploadSuccess,"show-file-list":!1}},[e.value?[t("div",{staticClass:"cover",on:{click:function(t){return t.stopPropagation(),e.handleRemove.apply(null,arguments)}}},[t("i",{staticClass:"el-icon-delete avatar-uploader-icon"})]),t("img",{staticClass:"avatar",attrs:{src:e.value}})]:t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],2)},a=[],s=r(9669),i=r.n(s),o={name:"single-upload",props:{value:{type:String,default:""},defaultImage:{type:String},uploadAction:{type:String,required:!0},removeAction:{type:String,required:!0},data:{type:Object,default:()=>({type:"common"})},headers:{type:Object,default:()=>({Authorization:`Bearer ${sessionStorage.access_token}`})}},methods:{handleBeforeUpload(e){let t=/^image\/(jpe?g|png)$/;const r=t.test(e.type),l=e.size/1024/1024<2;return r||this.$message.error("上传头像图片只能是 JPG/PNG 格式!"),l||this.$message.error("上传头像图片大小不能超过 2MB!"),r&&l},handleUploadSuccess(e,t){this.$emit("success",e),this.$emit("input",e.src)},handleUploadError({status:e,message:t},r,l){switch(e){case 401:this.$message.error("错误:401,Token失效,请重新登录!");break;case 400:t=JSON.parse(t),this.$message.error(`错误:400,${t}`);break;default:this.$message.error(`错误:${e},${t}!`);break}},async handleRemove(){let e=this.value.includes(this.defaultImage);if(!e){let{status:e}=await i().post(this.removeAction,{src:this.value});e&&this.$message.success("删除成功!")}this.$emit("input","")}}},n=o,d=r(1001),c=(0,d.Z)(n,l,a,!1,null,null,null),u=c.exports},9783:function(e,t,r){r.r(t),r.d(t,{default:function(){return u}});var l=function(){var e=this,t=e._self._c;return t("el-card",{staticClass:"table-card"},[t("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("轮播图管理")]),t("el-button",{attrs:{plain:"",type:"primary",icon:"el-icon-circle-plus-outline"},on:{click:function(t){e.insert_dialog_visible=!0}}},[e._v(" 添加轮播 ")])],1),t("el-table",{attrs:{data:e.tableData}},[t("el-table-column",{attrs:{prop:"slide_id",label:"#",width:"40"}}),t("el-table-column",{attrs:{prop:"picture",label:"轮播图片",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("el-image",{staticStyle:{width:"150px"},attrs:{src:e.row.picture,fit:"cover"}})]}}])}),t("el-table-column",{attrs:{prop:"title",label:"链接标题"}}),t("el-table-column",{attrs:{prop:"url",label:"跳转地址",width:"200"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-link",{attrs:{href:r.row.url,target:"_blank"}},[t("span",{staticClass:"am-text-xs"},[e._v(e._s(r.row.url))])])]}}])}),t("el-table-column",{attrs:{prop:"target",label:"跳转方式"}}),t("el-table-column",{attrs:{prop:"slide_order",label:"排序数字"}}),t("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-tag",{attrs:{type:1===r.row.usable?"success":"info"}},[e._v(" "+e._s(1===r.row.usable?"启用":"禁用")+" ")])]}}])}),t("el-table-column",{attrs:{prop:"create_time",label:"添加日期",width:"90"}}),t("el-table-column",{attrs:{prop:"update_time",label:"编辑日期",width:"90"}}),t("el-table-column",{attrs:{label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{icon:"el-icon-edit",type:"primary",plain:""},on:{click:function(t){return e.openEditDialog(r.row)}}},[e._v(" 编辑 ")]),t("el-button",{attrs:{icon:"el-icon-switch-button",type:1===r.row.usable?"info":"success",plain:""},on:{click:function(t){return e.handleSwitch(r.row)}}},[e._v(" "+e._s(1===r.row.usable?"禁用":"启用")+" ")]),t("el-button",{attrs:{icon:"el-icon-delete",type:"danger",plain:""},on:{click:function(t){return e.handleRemove(r.row.slide_id,r.$index)}}},[e._v(" 删除 ")])]}}])})],1),t("el-dialog",{attrs:{title:"添加轮播图",visible:e.insert_dialog_visible},on:{"update:visible":function(t){e.insert_dialog_visible=t},close:function(t){return e.handleDialogClose("insert_form")}}},[t("el-form",{ref:"insert_form",attrs:{model:e.insert_form,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"轮播图片",prop:"picture"}},[t("single-upload",{attrs:{"upload-action":"/upload/common/","remove-action":"/upload/remove/",data:{type:"common"}},model:{value:e.insert_form.picture,callback:function(t){e.$set(e.insert_form,"picture",t)},expression:"insert_form.picture"}})],1),t("el-form-item",{attrs:{label:"标题文字",prop:"title"}},[t("el-input",{attrs:{placeholder:"文字将作为标题，显示在图片上"},model:{value:e.insert_form.title,callback:function(t){e.$set(e.insert_form,"title",t)},expression:"insert_form.title"}})],1),t("el-form-item",{attrs:{label:"链接地址",prop:"url"}},[t("el-input",{attrs:{placeholder:"请输入完整的链接地址"},model:{value:e.insert_form.url,callback:function(t){e.$set(e.insert_form,"url",t)},expression:"insert_form.url"}})],1),t("el-form-item",{attrs:{label:"跳转方式",prop:"target"}},[t("el-radio",{attrs:{label:"_blank"},model:{value:e.insert_form.target,callback:function(t){e.$set(e.insert_form,"target",t)},expression:"insert_form.target"}},[e._v("新窗口跳转")]),t("el-radio",{attrs:{label:"_self"},model:{value:e.insert_form.target,callback:function(t){e.$set(e.insert_form,"target",t)},expression:"insert_form.target"}},[e._v("本窗口跳转")])],1),t("el-form-item",{attrs:{label:"显示排序",prop:"slide_order"}},[t("el-input",{attrs:{placeholder:"请输入数字，数字越小，排序越靠前"},model:{value:e.insert_form.slide_order,callback:function(t){e.$set(e.insert_form,"slide_order",t)},expression:"insert_form.slide_order"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.insert_dialog_visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleInsert}},[e._v("添 加")])],1)],1),t("el-dialog",{attrs:{title:"编辑轮播图",visible:e.edit_dialog_visible},on:{"update:visible":function(t){e.edit_dialog_visible=t},close:function(t){return e.handleDialogClose("edit_form")}}},[t("el-form",{ref:"edit_form",attrs:{model:e.edit_form,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"轮播图片",prop:"picture"}},[t("single-upload",{attrs:{"upload-action":"/upload/common/","remove-action":"/upload/remove/",data:{type:"common"}},model:{value:e.edit_form.picture,callback:function(t){e.$set(e.edit_form,"picture",t)},expression:"edit_form.picture"}})],1),t("el-form-item",{attrs:{label:"标题文字",prop:"title"}},[t("el-input",{attrs:{placeholder:"文字将作为标题，显示在图片上"},model:{value:e.edit_form.title,callback:function(t){e.$set(e.edit_form,"title",t)},expression:"edit_form.title"}})],1),t("el-form-item",{attrs:{label:"链接地址",prop:"url"}},[t("el-input",{attrs:{placeholder:"请输入完整的链接地址"},model:{value:e.edit_form.url,callback:function(t){e.$set(e.edit_form,"url",t)},expression:"edit_form.url"}})],1),t("el-form-item",{attrs:{label:"跳转方式",prop:"target"}},[t("el-radio",{attrs:{label:"_blank"},model:{value:e.edit_form.target,callback:function(t){e.$set(e.edit_form,"target",t)},expression:"edit_form.target"}},[e._v("新窗口跳转")]),t("el-radio",{attrs:{label:"_self"},model:{value:e.edit_form.target,callback:function(t){e.$set(e.edit_form,"target",t)},expression:"edit_form.target"}},[e._v("本窗口跳转")])],1),t("el-form-item",{attrs:{label:"显示顺序",prop:"slide_order"}},[t("el-input",{attrs:{placeholder:"请输入数字，数字越小，排序越靠前"},model:{value:e.edit_form.slide_order,callback:function(t){e.$set(e.edit_form,"slide_order",t)},expression:"edit_form.slide_order"}})],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.edit_dialog_visible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleEdit}},[e._v("保 存")])],1)],1)],1)},a=[],s=(r(7658),r(9424)),i=r(1862),o={name:"List",components:{SingleUpload:s.Z},data(){return{tableData:[],insert_dialog_visible:!1,insert_form:{picture:"",title:"",url:"http://",target:"_blank",slide_order:""},edit_dialog_visible:!1,current_slide:"",edit_form:{slide_id:"",picture:"",title:"",url:"",target:"_blank",slide_order:""},rules:{picture:[{required:!0,message:"请上传一张轮播图片",trigger:"change"}],title:[{message:"请填写标题文字",trigger:"blur"}],url:[{type:"url",required:!0,message:"请填写完整的链接地址",trigger:"blur"}],target:[{required:!0,message:"请选择一种跳转方式",trigger:"blur"},{type:"enum",enum:["_blank","_self"],message:"请选择合格跳转方式",trigger:"blur"}],slide_order:[{required:!0,message:"请填写显示顺序！",trigger:"blur"},{pattern:/^\d+$/,message:"顺序必须是数字组成！",trigger:"blur"}]}}},created(){document.title="轮播图管理",this.loadList()},methods:{async loadList(){let{status:e,msg:t,data:r}=await i.Mi.list();e&&(this.tableData=r)},handleInsert(){this.$refs.insert_form.validate((async e=>{if(e){let{status:e,msg:t,data:r}=await i.Mi.insert(this.insert_form);e?(this.tableData.push({...this.insert_form,...r}),this.tableData.sort(((e,t)=>e.slide_order-t.slide_order)),this.insert_dialog_visible=!1,this.$message.success(t)):this.$message.error(t)}}))},openEditDialog(e){this.current_slide=e,this.edit_form={...e},this.edit_dialog_visible=!0},handleEdit(){this.$refs.edit_form.validate((async e=>{if(e){let{status:e,msg:t,data:r}=await i.Mi.edit(this.edit_form);e?(Object.assign(this.current_slide,this.edit_form),this.edit_dialog_visible=!1,this.$message.success(t)):this.$message.error(t)}}))},async handleRemove(e,t){this.$confirm("此操作将永久删除该轮播图, 是否继续?",{type:"warning"}).then((async()=>{let{status:r,msg:l}=await i.Mi.remove({slide_id:e});r&&(this.tableData.splice(t,1),this.$message.success(l))})).catch((()=>{this.$message.info("取消成功")}))},handleSwitch(e){let{slide_id:t,usable:r}=e;this.$confirm(`此操作将${1===r?"禁用":"启用"}该轮播图，是否继续？`,{type:"warning"}).then((async()=>{let{status:l,msg:a}=await i.Mi.toggle({slide_id:t,usable:-r});l&&(Object.assign(e,{usable:-r}),this.$message.success(a))})).catch((()=>{this.$message.info("取消成功")}))},handleDialogClose(e){this.$refs[e].resetFields()}}},n=o,d=r(1001),c=(0,d.Z)(n,l,a,!1,null,"d5004702",null),u=c.exports}}]);
//# sourceMappingURL=promotion-slide.855664f8.js.map